1. To calculate average rating for a product
-> shell command: db.products.aggregate([
  // 1. Unwind the ratings array
  {
    $unwind: "$ratings"
  },
  // 2. Convert rating to a numeric value
  {
    $set: {
      "ratings.rating": { $toDouble: "$ratings.rating" }
    }
  },
  // 3. Group by product name and calculate average rating
  {
    $group: {
      _id: "$name",
      avgRating: { $avg: "$ratings.rating" }
    }
  }
])

2. To calculate no. of ratings on a product
-> shell command: db.products.aggregate([
    //1. project name and count of rating
    {
        $project:{name:1, countOfRating:{
            $cond:{
                if:{$isArray:"$ratings"},then:{$size:"$ratings"},else:0
            }
        } 
        }
    },
    // 2. sort the collection as count of rating
    {
        $sort:{
            countOfRating:-1
        }
    },
    //3. limit to 1 only
    {
        $limit:1
    }
])